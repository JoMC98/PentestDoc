# Simple CTF

### tags: `Try Hack Me` `Linux` `Simple CMS` `SQLi` `sudo`

## **FLAGS:**

* User Flag: G00d j0b, keep up!
* Root Flag: W3ll d0n3. You made it!

## **USERS:**

* mitch \(pwd: secret\)
* admin@admin.com

## **PREGUNTAS BÁSICAS:**

* _**How many services are running under port 1000?**_ --&gt; 2
* _**What is running on the higher port?**_ --&gt; SSH
* _**What's the CVE you're using against the application?**_ --&gt; CVE-2019-9053
* _**To what kind of vulnerability is the application vulnerable?**_ --&gt; SQLi
* _**Where can you login with the details obtained?**_ --&gt; SSH
* _**Is there any other user in the home directory? What's its name?**_ --&gt; sunbath
* _**What can you leverage to spawn a privileged shell?**_ --&gt; vim

## **ENUMERACIÓN**

1. Vemos si el host esta levantado y saber el SSOO \(**Linux**: TTL &lt;= 64\) `ping -c1 IP`

   ![](https://i.imgur.com/yGcz4WK.png)

2. Escaneamos los puertos abiertos
   * Primero vemos si va muy lento el escaneo: `nmap -p- --open -T5 -v -n IP`

     ```text
       -p-        Todos los puertos
       --open     Mostrar solos puertos abiertos
       -T5        Modo más agresivo
       -v         Modo verbose (reporta por pantalla)
       -n        No aplicar resolución DNS
     ```

   * Como va lento, lanzamos este otro comando: `nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP`

     ```text
       -sS        Realizar un TCP SYN port scan
       --min-rate    Emitir al menos 5000 paquetes por segundo
       -Pn        No realizar Host Discovery
     ```

     * Va más rápido y encuentra los puertos 21 \(FTP\), 80 \(HTTP\) y 2222 \(EtherNetIP-1\). Este último resulta bastante curioso.

       ![](https://i.imgur.com/Y4DywEJ.png)
3. Obtenemos los servicios que corren en los puertos. El 2222 resulta ser un SSH

   `nmap -sC -sV -p21,80,2222 IP`

   ![](https://i.imgur.com/2gj98Pj.png)

4. Nos centramos en el servidor web Apache. Lanzamos un whatweb para ver si usa algún CMS tipo Wordpress, pero vemos que no, es un Apache normal

   ![](https://i.imgur.com/KZ2E1kL.png)

5. Accedemos al portal web y vemos lo mismo con Wappalyzer. El portal no nos dice nada. Es la página por defecto de apache.
6. Vamos a hacer un fuzzing en el portal para encontrar alguna ruta con un script de enumeración de NMAP

   `nmap -sV --script=http-enum IP`

   ![](https://i.imgur.com/dbgs6Ed.png)

   * Hacemos el fuzz también con GoBuster, ya que lo pide como pregunta básica `gobuster dir -u IP -w DICT -q -n -e`

     ```text
       -u        Target 
       -w         Diccionario (/usr/share/wordlists/dirb/common.txt)
       -q        Silencioso, no muestra mensajes de estado           
       -n        No muestra códigos de estado        
       -e        Muestra URLs completas
     ```

     ![](https://i.imgur.com/X5t59xZ.png)

7. Con GoBuster encontramos más cosas. Vemos una ruta simple y al acceder, vemos un portal web con un CMS \(Made Simple\). Podemos verlo con Wappalizer.

   &lt;img src=[https://i.imgur.com/iyftWYq.png](https://i.imgur.com/iyftWYq.png) width=1500/&gt;

   * Si lanzamos el whatweb también lo vemos:

     ![](https://i.imgur.com/vIYm0q9.png)

   * Sobre /simple, lanzamos el fuzzing y vemos más xixa:

     ![](https://i.imgur.com/dj97Yo0.png)

   * Sobre /simple/admin nos lleva a un portal de login:

     ![](https://i.imgur.com/fbv3PLl.png)

8. Vamos a buscar info sobre este CMS, a ver si hay algún exploit o vulnerabilidad. Sabemos que es la versión 2.2.8.

   ![](https://i.imgur.com/d3UMgoN.png)

   * Vemos que es vulnerable a SQLinjection:

     ![](https://i.imgur.com/e1wiVRE.png)

## **SQL Injection**

Nos copiamos el exploit "/php/webapps/46635.py" a nuestro directorio.

![](https://i.imgur.com/n2VUw5U.png)

* Lanzamos el exploit. Tras instalar las librerias que faltan con PIP, vemos:

  ![](https://i.imgur.com/ProlqHh.png)

* Lanzamos el exploit sin la opción de crack. Tras un tiempo, obtenemos un usuario, un mail y una password:

  `python sqli.py -u` [`http://IP/simple`](http://IP/simple)

  ![](https://i.imgur.com/ukItrEO.png)

Tenemos un usuario: **mitch**

* También tenemos:
  * Un mail: **admin@admin.com**
  * Una password hasheada con salt: **0c01f4468bd75d7a84c7eb73846e8d96**
  * Un salt: **1dac0d92e9fa6bb2**
* La password está hasheada. Nos damos cuenta que deberiamos haber usado la opción de crack indicando la wordlist de rockyou. Para no volver a repetir la SQLi, hacemos una copia del exploit que solo haga la parte del cracking, hardcodeando el salt y la pass en el código.

  ![](https://i.imgur.com/mIdGKL0.png)

  Tenemos la password de mitch: **secret**

## **GET A SHELL**

Con el usuario y la contraseña, probamos a conectarnos por SSH. Hay que indicar el puerto:

`ssh mitch@IP -p 2222`

![](https://i.imgur.com/1GJQKgy.png)

## **USER FLAG**

En el directorio de mitch podemos ver la flag user.txt

Tenemos la user flag: **G00d j0b, keep up!**

## **ROOT FLAG**

Vamos a intentar una escalada de privilegios en Linux siguiendo este [tutorial](https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4)

1. En primer lugar, intentamos ver los privilegios de sudo del usuario mitch `sudo -l`.
2. Vemos que puede ejecutar el comando /usr/bin/vim como root sin contraseña. Siguiendo la guía, vemos que con vi \(similar a vim\), se puede escalar privilegios:

   ![](https://i.imgur.com/ulkE6Ci.png)

3. Lo intentamos:

   `sudo vim`

   ![](https://i.imgur.com/VinrDkv.png)

   ![](https://i.imgur.com/A7SJMW5.png)

4. Hemos escalado privilegios. Vamos al directorio /root a por la 2a Flag.

   Tenemos la root flag: **W3ll d0n3. You made it!**

5. Funciona igual con :!bash y despertamos una bash:

   ![](https://i.imgur.com/vjGrHOL.png)

