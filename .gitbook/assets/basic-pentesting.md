# Basic Pentesting

###### tags: `Try Hack Me` `Linux` `SMB` `SSH`
________________________

### **FLAGS:** 
    - Flag: heresareallystrongpasswordthatfollowsthepasswordpolicy$$

________________________

### **USERS:**
    - Jan (pwd: armando)
    - Kay (pwd de su id_rsa: beeswax)

________________________

### **BASIC QUESTIONS**

- ***Find the services exposed by the machine*** 
    Varios HTTP,SSH,SMB

- ***What is the name of the hidden directory on the web server?***
    development

- ***What is the username and password?***
    user: Jan
    pwd: armando

- ***What service do you use to access the server?***
    SSH
    
- ***What is the name of the other user you found?***
    kay

________________________

### **PASOS**

1. Vemos si el host esta levantado y saber el SSOO (**Linux**: TTL <= 64)
<code>ping -c1 IP</code>

    ![](https://i.imgur.com/Bz8b6tR.png)

2. Escaneamos los puertos abiertos

    - Primero vemos si va muy lento el escaneo:
    <code>nmap -p- --open -T5 -v -n IP</code>
    
            -p-		Todos los puertos
            --open 	Mostrar solos puertos abiertos
            -T5		Modo más agresivo
            -v 		Modo verbose (reporta por pantalla)
            -n		No aplicar resolución DNS
        
    - Como va lento, lanzamos este otro comando:
    <code>nmap -sS --min-rate 5000 -p- -vvv -n -Pn IP</code>
    
            -sS		Realizar un TCP SYN port scan
            --min-rate	Emitir al menos 5000 paquetes por segundo
            -Pn		No realizar Host Discovery

     - Va más rápido y encuentra varios puertos

        ![](https://i.imgur.com/kG9q5me.png)


3. Obtenemos los servicios que corren en los puertos
<code>nmap -sC -sV -p22,80,139,445,8008,8080 IP</code>

    ![](https://i.imgur.com/e2Whhnv.png)

4. Hacemos un fuzzing con GoBuster
    
    <code>gobuster dir -u IP -w DICT -q -n -e</code>

        -u		Target 
        -w		Diccionario (/usr/share/wordlists/dirb/common.txt)
        -q		Silencioso, no muestra mensajes de estado           
        -n		No muestra códigos de estado        
        -e		Muestra URLs completas
        
    ![](https://i.imgur.com/HH1pOeF.png)

5. Para encontrar usuarios y contraseñas, vamos a tirar por el SMB. Listamos las unidades compartidas de forma anónima:

    <code>smbclient -L \\IP -N</code>

    ![](https://i.imgur.com/36Wd6Uj.png)

    - Vemos un Disco compartido "Anonymous". Probamos a conectarnos:

        <code>smbclient //IP/Anonymous</code>
        
        ![](https://i.imgur.com/Tm6cLVy.png)

    - Se conecta y vemos un fichero staff.txt. Con un <code>get FILE</code> lo descargamos a nuestra máquina y lo podemos ver

        ![](https://i.imgur.com/H7vGRiR.png)

        <mark>Tenemos los usernames: **Jan y Kay**</mark>

6. Para obtener las passwords, vamos a hacer fuerza bruta sobre el servicio SSH con los 2 usuarios con Hydra.

    <code>hydra -l jan -P DICT ssh://IP -t 16</code>
        
        -l            Usuario
        -P            Diccionario de passwords (/usr/share/wordlists/rockyou.txt)
        ssh://IP      Servidor al que atacar
        -t            Número de hilos
        
    ![](https://i.imgur.com/vIF2GHi.png)

    <mark>Tenemos la password de Jan: **armando**</mark>

    - Nos conectamos por SSH con el usuario Jan

    ![](https://i.imgur.com/NuCESHW.png)

7. Navegamos un poco por el servidor. Vemos un directorio home de Jan vacío y uno de Kay con el fichero pass.bak, que parece la flag. No tenemos acceso.

    - Vemos que tiene un fichero .ssh/id_rsa, es decir, una clave privada para conectar por SSH. Está encriptada.

8. Con **john**, intentamos crackear la password de la llave privada. La copiamos en nuestra máquina.

    - Primero, convertimos la Clave en un hash para john, con **ssh2john**
        
        <code>python /usr/share/john/ssh2john.py id_rsa > id_rsa.hash</code>
        
        ![](https://i.imgur.com/dJ7LNC5.png)

    - Con **john**, crackeamos el hash, usando como DICT **/usr/share/wordlists/rockyou.txt**:

        <code>/usr/sbin/john --wordlist=DICT id_rsa.hash</code>
        
        ![](https://i.imgur.com/y5tLQ1a.png)

        <mark>Tenemos la password del id_rsa de Kay: **beeswax**</mark>
        
10. Cambiamos los permisos al id_rsa con <code>chmod 400 id_rsa</code> y nos conectamos a la máquina, introduciendo la PASSPHRASE

    <code>ssh -i id_rsa USER@IP</code>
    
    ![](https://i.imgur.com/aasGUdT.png)
    
    - Ya podemos leer el fichero pass.bak y obtener la flag

    <mark>Tenemos la flag: **heresareallystrongpasswordthatfollowsthepasswordpolicy$$**</mark>

_______________

Había una pregunta que nos indica que enumeremos el sistema. Podemos usar este [script](https://github.com/rebootuser/LinEnum) de enumeración en Linux 